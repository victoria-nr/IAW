
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://victoria-nr.github.io/IAW/Unidad%204/PracNoUsadas/T06_integrandovolsyconts/">
      
      
        <link rel="prev" href="../P3/">
      
      
        <link rel="next" href="../T07_wp_docker-compose/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>6 Integrar contenedores y volúmenes - Implantación de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-3NX5MD5C8H"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-3NX5MD5C8H",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-3NX5MD5C8H",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integrar-contenedores-y-volumenes" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../.." title="Implantación de aplicaciones web" class="md-header__button md-logo" aria-label="Implantación de aplicaciones web" data-md-component="logo">
      
  <img src="../../../assets/logocaminas.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Implantación de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6 Integrar contenedores y volúmenes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Implantación de aplicaciones web" class="md-nav__button md-logo" aria-label="Implantación de aplicaciones web" data-md-component="logo">
      
  <img src="../../../assets/logocaminas.png" alt="logo">

    </a>
    Implantación de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unidad 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Unidad 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%201/Ud1_1_introModulo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción al módulo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prácticas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Prácticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%201/P1_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    P1.1. Linux Server en AWSAcademy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%201/P1_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    P1.2 Windows Server en AWSAcademy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%201/P1_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    P1.3. Conceder acceso a un segundo administrador
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%201/P1_4_tallerGitIntro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taller 1: Introducción a git y GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%201/P1_5_tallerGitRamasUniones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taller 2: Git. Trabajando con ramas y uniones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%201/P1_6_tallerMarkdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taller 3: Introducción a Markdown
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unidad 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Unidad 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%202/Ud2_1_Imp_ArqWeb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1. Arquitecturas web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%202/Ud2_2_Func_app_web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2. Funcionamiento de una aplicación Web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%202/Ud2_3_ArqWeb_serweb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3. Implantación y administración de servidores web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%202/Ud2_4_Serv_web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4. Servidores web: Nginx vs Apache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%202/Ud2_5_Infraestructura_despliegue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.5. Infraestructura para el despliegue de aplicaciones web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%202/Ud2_6_HTTP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.6. El protocolo HTTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Unidad%202/Ud2_7_HTTPS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.7. El protocolo HTTPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prácticas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="integrar-contenedores-y-volumenes">Integrar contenedores y volúmenes</h1>
<p>Ya tenemos suficientes conocimientos para montar un servicio completo usando Docker. Para ello vamos a necesitar levantar contenedores que trabajen juntos y accedan a volúmenes para guardar los datos. </p>
<p>En este caso vamos a montar un <em>blog</em> con <em>WordPress</em>. </p>
<div class="admonition atención">
<p class="admonition-title">Atención</p>
<p>Lo importante de este capítulo no es saber montar un Wordpress. Eso es solo un ejemplo y no necesitas saber cómo se monta un Wordpress. Lo importante es saber crear los contenedores, enlazarlos entre ellos, usar un volumen. No te preocupes si no entiendes los detalles de los parámetros que se pasan a Wordpress. No es relevante.</p>
</div>
<p>Wordpress es un servicio de blogs y páginas web que necesita para funcionar:</p>
<ul>
<li>PHP</li>
<li>Una base de datos MySQL o MariaDB.</li>
<li>Soporte HTTPS</li>
</ul>
<p>En una instalación tradicional bastaría un servidor donde instalaríamos PHP, una base de datos, un servidor web Apache o Nginx con soporte https y el propio servidor worpress. La base de datos se almacenaría en el sistema de archivos del propio servidor. Los ficheros de configuración y las páginas que se fueran creando se almacenarían también en el propio servidor.</p>
<p>Pero en el despliegue con contenedores usaremos:</p>
<ul>
<li>Un contenedor, que llamaremos <strong>wordpress</strong>, conendrá el servidor Wordpress.</li>
<li>Este contenedor almacenará los ficheros de configuración y páginas que creemos en una carpeta de la máquina host </li>
<li>Otro contenedor, que llamaremos <strong>wordpress-db</strong>, contendrá el sistema gestor de base de datos MariaDB. </li>
<li>Dicho gestor MariaDB guardará la base de datos en un volumen docker, no en el propio contenedor. Usaremos el volumen creado en el capítulo anterior y que llamamos <strong>vol-wordpress-db</strong>.</li>
<li>Enlazaremos ambos contenedores <strong>wordpress</strong> y <strong>wordpres-db</strong></li>
</ul>
<div class="admonition importante">
<p class="admonition-title">Importante</p>
<p>Como vemos al hacer un despliegue en docker independizamos los servidores de los datos. De esta forma podremos actualizar el sistema a otra versión, o hacer pruebas de plugins o modificaciones simplemente creando o sustituyendo el contenedor del servidor por uno nuevo que acceda a los mismos datos.</p>
</div>
<h2 id="crear-el-volumen">Crear el volumen</h2>
<p>Empezaremos creando un volumen que se llame <strong>vol-wordpress-db</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">    $ </span>docker<span class="w"> </span>volume<span class="w"> </span>create<span class="w"> </span>vol-wordpress-db
</code></pre></div>
<h2 id="crear-un-contenedor-con-mariadb">Crear un contenedor con <em>MariaDB</em>.</h2>
<p><em>WordPress</em> soporta los motores relaciones <em>MySQL</em> y <em>MariaDB</em>. Usaremos este último. Vamos a crear nuestra base de datos usando volumen el volumen que acabamos de crear para que guarde los datos.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>wordpress-db<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span>--mount<span class="w"> </span><span class="nv">source</span><span class="o">=</span>vol-wordpress-db,target<span class="o">=</span>/var/lib/mysql<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span>-e<span class="w"> </span><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>secret<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span>-e<span class="w"> </span><span class="nv">MYSQL_DATABASE</span><span class="o">=</span>wordpress<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span>-e<span class="w"> </span><span class="nv">MYSQL_USER</span><span class="o">=</span>manager<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span>-e<span class="w"> </span><span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>secret<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span>mariadb:10.3.9
</code></pre></div>
La imagen se descargará, si no lo estaba ya, y se iniciará nuestro contenedor de <em>MariaDB</em>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="hll"><span class="go">docker run -d --name wordpress-db \</span>
</span><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="hll"><span class="go">    --mount source=vol-wordpress-db,target=/var/lib/mysql \</span>
</span><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="hll"><span class="go">    -e MYSQL_ROOT_PASSWORD=secret \</span>
</span><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="hll"><span class="go">    -e MYSQL_DATABASE=wordpress \</span>
</span><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="hll"><span class="go">    -e MYSQL_USER=manager \</span>
</span><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="hll"><span class="go">    -e MYSQL_PASSWORD=secret \</span>
</span><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="hll"><span class="go">    mariadb:10.3.9</span>
</span><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="go">Unable to find image &#39;mariadb:10.3.9&#39; locally</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="go">10.3.9: Pulling from library/mariadb</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="go">124c757242f8: Pull complete </span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="go">9d866f8bde2a: Pull complete </span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="go">fa3f2f277e67: Pull complete </span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="go">398d32b153e8: Pull complete </span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="go">afde35469481: Pull complete </span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="go">31f2ae82b3e3: Pull complete </span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="go">3eeaf7e45ea6: Pull complete </span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="go">716982328e17: Pull complete </span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="go">34ce605c9036: Pull complete </span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="go">4502ed9073c0: Pull complete </span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="go">2afafbdf5a96: Pull complete </span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="go">43d52b11dd31: Pull complete </span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="go">30c7b70556f3: Pull complete </span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="go">8b1b39f2f89a: Pull complete </span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="go">41480b9319d7: Pull complete </span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="go">Digest: sha256:b7894bd08e5752acdd41fea654cb89467c99e67b8293975bb5d787b27e66ce1a</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="go">Status: Downloaded newer image for mariadb:10.3.9</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="go">30634831d17108aa553a5774e27f398760bdbdf32debc3179843e73aa5957956</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="gp">$ </span>docker<span class="w"> </span>ps
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="go">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="go">30634831d171        mariadb:10.3.9      &quot;docker-entrypoint.s…&quot;   20 seconds ago      Up 16 seconds       3306/tcp            wordpress-db</span>
</code></pre></div>
<p>Analicemos las distintas partes del comando.</p>
<ul>
<li>
<p>Lo primero que habremos notado es que el contenedor ya no se queda en primer plano. El parámetro <code>-d</code> indica que debe ejecutarse como un proceso en segundo plano. Así no podremos pararlo por accidente con <code>Control+C</code>.</p>
</li>
<li>
<p>Lo segundo es que vemos que el contenedor usa un puerto, el <code>3306/tcp</code>, pero no está enlazado a ningún puerto de la máquina anfitrión. Nosotros no hemos usado el parámetro <code>-p PUERTOANFITRION:PUERTOCONTENEDOR</code> como en otros casos ni hemos dicho en la configuración nada respecto al puerto a exponer. Esa información ya está en la imagen que usamos. Con esta configuración no tenemos forma de acceder a la base de datos directamente. Nuestra intención es que solo el contenedor de <em>WordPress</em> (que crearemos a continuación) pueda acceder. En este caso el puerto 3306/tcp, por el que se accede al servidor de MariaDB se está <em>exponiendo</em>, es decir, haciéndolo disponible <strong>solo</strong> a otros contenedores. Ni siquiera se podrá acceder desde la máquina anfitrión.</p>
</li>
<li>
<p>Luego una serie de parámetros <code>-e</code> que nos permite configurar nuestra base de datos pasándole variables de entorno al contenedor. Como dijimos anteriormente no nos preocupan estos parámetros, aunque son bastante autoexplicativos.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Los contenedores se configuran a través de variables de entorno, que podemos configurar con el parámetro <code>-e</code> que vemos en la orden anterior. Gracias a ellos hemos creado una base de datos, un usuario y configurado las contraseñas.</p>
<p>Se recomienda buscar en el registro de <em>Docker</em> la imagen oficial de <a href="https://hub.docker.com/_/mariadb/">MariaDB</a> para entender el uso de los parámetros.</p>
</div>
</li>
<li>
<p>Por último, el parámetro <code>--mount</code> nos permite enlazar el volumen <strong>vol-wordpress-db</strong> que creamos en el paso anterior con el directorio <code>/var/lib/mysql</code> del contenedor. Ese directorio es donde se guardan los datos de <em>MariaDB</em>. Eso significa que si borramos el contenedor, o actualizamos el contenedor a una nueva versión, no perderemos los datos porque ya no se encuentran en él, sino en el volumen. Solo lo perderíamos si borramos explícitamente el volumen.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Cada contendor que usemos tendrá uno o varios directorios donde se deben guardar los datos no volátiles. Nos corresponde a nosotros conocer la herramienta y saber de qué directorios se tratan. Usualmente están en la documentación del contenedor, pero no siempre.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>El parámetro <code>--mount</code> se empezó a utilizar desde la versión <code>17.06</code> para contenedores independientes (los que no pertenecen a un enjambre o <em>swarm</em>). Los que conozcan <em>Docker</em> de versiones más antiguas estarán más acostumbrados a usar el parámetro <code>--volume</code> que hace algo similar. Sin embargo la documentación aconseja usar ya <code>--mount</code>, sobre todo para nuevos usuarios.</p>
<p>Nosotros somos muy obedientes así que en este taller usaremos <code>--mount</code>.</p>
</div>
</li>
<li>
<p>Finalmente indicamos la imagen que vamos a usar: <code>mariadb:10.3.9</code>.</p>
</li>
</ul>
<h2 id="creando-nuestro-blog">Creando nuestro blog</h2>
<p>Vamos ahora a crear nuestro contenedor de <em>WordPress</em>, y a conectarlo con nuestra base de datos. Además, queremos poder editar los ficheros de las plantillas, por si tenemos que modificar algo, así que necesitaremos montar el directorio del contenedor donde está instalado <em>WordPress</em> con nuestra cuenta de usuario en la máquina anfitrión.</p>
<p>Vamos a crear el espacio de trabajo en la máquina anfitrión donde estamos usando docker:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="go">mkdir -p ~/Sites/wordpress/target &amp;&amp; cd ~/Sites/wordpress</span>
</code></pre></div>
<p>Y dentro de este directorio arrancamos el contenedor:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="go">docker run -d --name wordpress \</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="go">    --link wordpress-db:mysql \</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="go">    --mount type=bind,source=&quot;$(pwd)&quot;/target,target=/var/www/html \</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="go">    -e WORDPRESS_DB_USER=manager \</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="go">    -e WORDPRESS_DB_PASSWORD=secret \</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="go">    -p 8080:80 \</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="go">    wordpress:4.9.8</span>
</code></pre></div>
<p>Revisa bien los distintos parámetros, la mayoría ya los hemos visto antes:</p>
<ul>
<li><code>-d</code> para lanzar en 2º plano</li>
<li>--mount para enlazar un directorio en el contenedor con un directorio en la máquina anfitrión</li>
<li>-e para definir parámetros en el contenedor</li>
<li>-p 8080:80 para enlazar el puerto 8080 en el anfitrión con el 80 en el contenedor.</li>
</ul>
<p>Pero encontramos un parámetro nuevo:</p>
<ul>
<li>--link wordpress-db:mysql: indica que este contenedor se vincula con otro llamado "wordpress-db", y permite que este contenedor lo referencie utilizando el alias "mysql".</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Puedes encontrar toda la información referente a esta imagen en DockerHub buscando la imagen <a href="https://hub.docker.com/_/wordpress">wordpress</a>.</p>
<p>Pero insisto, no se trata de saber montar un Wordpress, sino de aprender cómo usar contenedores que se enlazan, usan un volumen, etc.</p>
</div>
<p>Cuando termine la ejecución, si accedemos a la dirección <a href="http://localhost:8080/">http://localhost:8080/</a>, ahora sí podremos acabar el proceso de instalación de nuestro WordPress. Recuerda que si accedes desde un navegador en un equipo distinto al que estás lanzando los contenedores deberás usar <code>http://IPSERVER:8080</code> sustituyendo IPSERVER por la IP de tu máquina anfitrión.</p>
<p>Si listamos el directorio target comprobaremos que tenemos todos los archivos de instalación accesibles desde el directorio anfitrión.</p>
<div class="admonition ejercicios">
<p class="admonition-title">Ejercicios</p>
<p>Ejercicios:</p>
<ol>
<li>Para los contenedores, tanto <strong>wordpress</strong> como <strong>wordpress-db</strong>.</li>
<li>Borra ambos.</li>
<li>Comprueba que sigue existiendo el volumen <strong>vol-wordpress-db</strong> que contiene la base de datos.</li>
<li>Comprueba que sigue existiendo el directorio ~/Sites/worpress/target en la máquina anfitrión con los ficheros de configuración.</li>
<li>Vuelve a crear el contenedor <strong>wordpress-db</strong> pero actualizando la versión de MariaDb. Usa la imagen mariadb:11.</li>
<li>Vuelve a crear el contenedor <strong>wordpress</strong> pero actualizando la versión de Wordpress. Usa la imagen wordpress:5.0.0-apache.</li>
<li>Vuelve a acceder a tu wordpress y comprueba lo que ha costado actualizar la versión y cómo se han mantenido los datos de la base de datos y de los ficherso guardados en el anfitrión.</li>
<li>Vuelve a borrarlos y borra también el volumen.</li>
<li>Vuelve a crear el volumen y los contenedores y comprueba que ahora sí hay que volver a instalar <em>WordPress</em>. Ahora puedes hacerlo con la versión latest de ambos servidores.</li>
</ol>
</div>
<div class="admonition nota">
<p class="admonition-title">Nota</p>
<p>Si intentas actualizar a las versiones latest de ambos servidores sin eliminar el volumen y los ficheros en ~/Sites/worpress/target no te funcionará. Probablemente en algún cambio de versión, bien de MariaDB o de Wordpress, cambió la forma de almacenar la información y se perdió la compatibilidad hacia atrás, con lo que no son capaces de leer los datos existentes</p>
</div>
<h2 id="para-saber-mas">Para saber más</h2>
<p>Para los efectos de este curso es suficiente con lo visto hasta aquí. Pero si quieres saber más y estudiaste el documento de "Para saber más" de la sección anterior donde profundizaba en volúmenes y redes docker, puedes hacer la práctica siguiente.</p>
<p>En esta práctica hace lo mismo que hemos visto anteriormente pero no usa el parámetro --link para enlazar los contenedores. A partir de Docker 1.13, el uso de --link ha sido desaconsejado en favor de la creación de redes para conectar contenedores.</p>
<p><a href="Ud7_img/Docker05_03CasoPractico01.pdf">Caso práctico 01 - Wordpress + MySQL</a></p>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>
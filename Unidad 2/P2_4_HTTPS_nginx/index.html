
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://victoria-nr.github.io/IAW/Unidad%202/P2_4_HTTPS_nginx/">
      
      
        <link rel="prev" href="../P2_3_proxy_inv_nginx/">
      
      
        <link rel="next" href="../P2_5_Balanceo_carga/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Practica 2.4 - Activación HTTPS en proxy inverso NGINX - Implantación de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-3NX5MD5C8H"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-3NX5MD5C8H",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-3NX5MD5C8H",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-24-activacion-https-en-proxy-inverso-nginx" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Implantación de aplicaciones web" class="md-header__button md-logo" aria-label="Implantación de aplicaciones web" data-md-component="logo">
      
  <img src="../../assets/logocaminas.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Implantación de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Practica 2.4 - Activación HTTPS en proxy inverso NGINX
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Implantación de aplicaciones web" class="md-nav__button md-logo" aria-label="Implantación de aplicaciones web" data-md-component="logo">
      
  <img src="../../assets/logocaminas.png" alt="logo">

    </a>
    Implantación de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unidad 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Unidad 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%201/Ud1_1_introModulo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción al módulo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prácticas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Prácticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%201/P1_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    P1.1. Linux Server en AWSAcademy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%201/P1_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    P1.2 Windows Server en AWSAcademy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%201/P1_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    P1.3. Conceder acceso a un segundo administrador
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%201/P1_4_tallerGitIntro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taller 1: Introducción a git y GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%201/P1_5_tallerGitRamasUniones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taller 2: Git. Trabajando con ramas y uniones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%201/P1_6_tallerMarkdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taller 3: Introducción a Markdown
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unidad 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Unidad 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ud2_1_Imp_ArqWeb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1. Implantación de arquitecturas web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ud2_2_ArqWeb_serweb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2. Arquitectura Web. Implantación y administración de servidores web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ud2_3_HTTP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3. Los protocolos HTTP y HTTPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Ud2_4_Serv_web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4. Servidores web: Nginx vs Apache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prácticas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Prácticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../P2_1_nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.1 – Instalación y configuración del servidor web Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../P2_2_autenticacion_nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.2 – Autenticación en Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../P2_3_proxy_inv_nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.3 – Proxy inverso con Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Practica 2.4 - Activación HTTPS en proxy inverso NGINX
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Practica 2.4 - Activación HTTPS en proxy inverso NGINX
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requisitos-antes-de-comenzar-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      Requisitos antes de comenzar la práctica
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introducción">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#certificados" class="md-nav__link">
    <span class="md-ellipsis">
      Certificados
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tarea" class="md-nav__link">
    <span class="md-ellipsis">
      Tarea
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tarea">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creacion-de-certificado-autofirmado" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de certificado autofirmado
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-ssl-en-el-proxy-inverso" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración SSL en el proxy inverso
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comprobaciones" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobaciones
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redireccion-forzosa-a-https" class="md-nav__link">
    <span class="md-ellipsis">
      Redirección forzosa a HTTPS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluacion" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluación
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../P2_5_Balanceo_carga/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica Voluntaria 2.5 – Balanceo de carga con proxy inverso en Nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../P2_6_balanceo_con_ssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica Voluntaria 2.6 - Proxy inverso y balanceo de carga con SSL en NGINX
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Unidad 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Unidad 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%203/Ud3_1_App_Web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1. Implantación de aplicaciones web PHP. La pila LAMP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prácticas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Prácticas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%203/P3_1_InstallServWebLAMP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 1: Instalación de un servidor LAMP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%203/P3_2_PHPMyAdmin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2: Herramientas relacionadas con la pila LAMP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%203/P3_3_VirtualhostingApache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 3: VirtualHosting con Apache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%203/P3_4_AppBookMedik/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 4: Instalación de la aplicación BookMedik
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Unidad%203/P3_5_CMSWordPress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 5: Instalación del CMS WordPress
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="practica-24-activacion-https-en-proxy-inverso-nginx">Practica 2.4 - Activación HTTPS en proxy inverso NGINX</h1>
<h2 id="requisitos-antes-de-comenzar-la-practica">Requisitos antes de comenzar la práctica</h2>
<div class="admonition danger">
<p class="admonition-title">Atención, muy importante antes de comenzar</p>
<ul>
<li>La práctica 2.3 ha de estar funcionando correctamente</li>
<li>No comenzar la práctica antes de tener la 2.3 <strong><em>funcionando y comprobada</em></strong></li>
</ul>
</div>
<h2 id="introduccion">Introducción</h2>
<p>Como vimos en la teoría el protocolo HTTP es un procotoco inseguro ya que las comunicaciones entre cliente web y servidor web no están cifradas. Por tanto, no podemos tener la seguridad de que la página que estamos visualizando no ha sido modificada en el trayecto del servidor al cliente. Gracias a HTTPS, las comunicaciones están cifradas mediante un certificado SSL/TSL. Veamos cómo hacer que las comunicaciones en el escenario que definimos en la práctica anterior estén cifradas.</p>
<h3 id="certificados">Certificados</h3>
<p>HTTPS se basa en el uso de certificados digitales. </p>
<p>Grosso modo, cuando entramos en una web vía HTTPS, esta nos presenta un certificado digital para asegurar que es quién dice ser. ¿Cómo sabemos que ese certificado es válido? Debemos consultar a la Autoridad de Certificación (CA) que emitió ese certificado si es válido. </p>
<p>Las CA son entidades que emiten certificados y su funcionamiento se basa en la confianza. Confiamos en que los certificados emitidos y firmados por esas entidades son reales y funcionales.  </p>
<p><img alt="" src="../P2_4/4.1-17.png" /></p>
<p>Los navegadores web tienen precargadas las Autoridades de Certificación en las que confían por defecto a la hora de navegar por webs HTTPS: </p>
<p><img alt="" src="../P2_4/4.1-18.png" /></p>
<p>Si accedemos a una web cuyo certificado no haya sido emitido y firmado por una de estas entidades, nos saltará el famoso aviso: </p>
<p><img alt="" src="../P2_4/4.1-19.png" /></p>
<p>Ya que si el certificado no ha sido emitido y firmado por una CA de confianza, puede que se trate de una web maliciosa que nos suponga un riesgo de seguridad, como bien dice el aviso. </p>
<h2 id="tarea">Tarea</h2>
<p>A partir de las prácticas anteriores hemos llegado a un escenario donde un proxy inverso actúa de intermediario entre el cliente y un servidor web Nginx.</p>
<p>Ya dijimos que una importante función que podía tener un proxy inverso era realizar el cifrado y descifrado de SSL para utilizar HTTPS en los servidores web. De esta forma se aliviaba la carga de trabajo de los servidores web, ya que es una tarea que consume recursos.</p>
<p>Podría llegarse a pensar que en términos de seguridad no es adecuado que el tráfico de red entre el proxy inverso y el servidor web vaya sin cifrar (HTTP). Sin embargo, pensando en un caso real, la red privada y el proxy inverso, además de estar en la misma red privada, suelen estar administrados por las mismas personas de la misma empresa, por lo que no supone un peligro real que ese tráfico vaya sin cifrar.</p>
<p>Podría cifrarse si fuera necesario, pero entonces pierde sentido que el proxy inverso se encargue del cifrado SSL para HTTPS, ya que haríamos el mismo trabajo dos veces.</p>
<p>En definitiva, tendríamos un esquema como el siguiente:</p>
<p><img alt="" src="../P2_4/p2.3https.png" /></p>
<h3 id="creacion-de-certificado-autofirmado">Creación de certificado autofirmado</h3>
<p>Nosotros no utilizaremos certificados de ninguna CA de confianza, básicamente porque: </p>
<ul>
<li>
<p>Nuestros servicios no están publicados en Internet </p>
</li>
<li>
<p>Estos certificados son de pago </p>
</li>
</ul>
<p>Así pues, nosotros crearemos nuestros propios certificados y los firmaremos nosotros mismos como si fuéramos una CA auténtica para poder simular este escenario.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Esto provocará que cuando accedamos por HTTPS a nuestro sitio web por primera vez, nos salté el aviso de seguridad que se comentábamos en la introducción. </p>
</div>
<p>En este caso no habrá peligro, puesto que estamos 100% seguros que ese certificado lo hemos emitido nosotros para esta práctica, no hay dudas. </p>
<p>Veamos pues el proceso para generar los certificados y las claves asociadas a ellos (privada/pública). En primer lugar, en el servidor que hace de proxy inverso debemos crear el siguiente directorio: </p>
<p><code>/etc/nginx/ssl</code></p>
<p>Podemos crear el certificado y las claves de forma simultánea con un único comando, donde: </p>
<ul>
<li>
<p><strong><code>openssl</code></strong>: esta es la herramienta por línea de comandos básica para crear y administrar certificados, claves y otros archivos OpenSSL. </p>
</li>
<li>
<p><strong><code>req</code></strong>: este subcomando se utiliza para generar una solicitud de certificados y también solicitudes de firma de certificados (CSR). </p>
</li>
<li>
<p><strong><code>-x509</code></strong>: Esto modifica aún más el subcomando anterior al decirle a la herramienta que queremos crear un certificado autofirmado en lugar de generar una solicitud de firma de certificado, como sucedería normalmente. </p>
</li>
<li>
<p><strong><code>-nodes</code></strong>: Esto le dice a OpenSSL que omita la opción de asegurar nuestro certificado con contraseña. Necesitamos que Nginx pueda leer el archivo sin la intervención del usuario cuando se inicia el servidor. Una contraseña evitaría que esto sucediera ya que tendríamos que introducirla a mano después de cada reinicio. </p>
</li>
<li>
<p><strong><code>-days 365</code></strong>: esta opción establece el tiempo durante el cual el certificado se considerará válido. Lo configuramos para un año. </p>
</li>
<li>
<p><strong><code>-newkey rsa: 2048</code></strong> : Esto especifica que queremos generar un nuevo certificado y una nueva clave al mismo tiempo. No creamos la clave necesaria para firmar el certificado en un paso anterior, por lo que debemos crearla junto con el certificado. La parte rsa:2048 le dice que cree una clave RSA de 2048 bits de longitud. </p>
</li>
<li>
<p><strong><code>-keyout</code></strong>: este parámetro le dice a OpenSSL dónde colocar el archivo de clave privada generado que estamos creando. </p>
</li>
<li>
<p><strong><code>-out</code></strong>: Esto le dice a OpenSSL dónde colocar el certificado que estamos creando. </p>
</li>
</ul>
<p>El comando completo sería así: </p>
<p><img alt="" src="../P2_4/4.1-22.png" /></p>
<p>Os solicitará que introduzcáis una serie de parámetros, como véis en la imagen. Debéis introducir los mismos parámetros que en la imagen excepto en el “Organizational Unit Name”. Ahí deberéis poner  <code>2ASIX – IAW - VuestroNombre</code>.</p>
<p>Si no te ha dado ningún error comprueba los archivos creados en <code>etc/nginx/ssl</code> y el contenido de cada uno de ellos.</p>
<h3 id="configuracion-ssl-en-el-proxy-inverso">Configuración SSL en el proxy inverso</h3>
<p>De la práctica anterior, dentro del directorio <code>/etc/nginx/sites-available</code> ya debéis tener el archivo de configuración llamado <code>ejemplo-proxy</code>. Es precisamente aquí donde realizaremos la configuración para que el acceso al sitio web se realice mediante SSL (HTTPS). </p>
<p>Dentro del bloque <code>server {…}</code> debéis cambiar el puerto de escucha (<code>listen 80</code>) por lo que véis en la imagen de abajo, añadiendo las siguientes líneas de configuración también, de tal forma que quede: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>        listen 443 ssl;
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>        ssl_certificate /etc/nginx/ssl/server.crt;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        ssl_certificate_key     /etc/nginx/ssl/server.key;
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        ssl_ciphers &#39;TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384&#39;;
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        ssl_protocols TLSv1.2 TLSv1.3;
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        access_log /var/log/nginx/https_access.log;
</code></pre></div>
<p>Donde le estáis diciendo que: </p>
<ul>
<li>
<p>Escuche en el puerto 443 → Puerto por defecto de HTTPS </p>
</li>
<li>
<p>El directorio donde está el certificado que habéis generado anteriormente </p>
</li>
<li>
<p>El directorio donde está la clave que habéis generado anteriormente </p>
</li>
<li>
<p>Los protocolos y tipos de cifrados que se pueden utilizar → Estas son las versiones de protocolos y los tipos de cifrados considerados seguros a día de hoy (hay muchos más pero no se consideran seguros actualmente) </p>
</li>
<li>
<p><code>server_name</code> ya lo teníais de la práctica anterior, no hace falta tocarlo </p>
</li>
<li>
<p>El archivo donde se guardan los logs cambia de nombre, ahora será https_access.log </p>
</li>
</ul>
<p>Recordad que tras modificar cualquier configuración de un servicio, hay que reiniciar el servicio, en este caso Nginx. </p>
<h3 id="comprobaciones">Comprobaciones</h3>
<ul>
<li>
<p>Si accedéis ahora a <code>https://ejemplo-proxy</code> os debería saltar un aviso de seguridad debido a que nuestro certificado es autofirmado, como comentábamos anteriormente. </p>
</li>
<li>
<p>Para comprobar que los datos del certificado son, efectivamente, los vuestros podéis comprobarlo así. Pulsando en el candado de la barra de búsqueda: </p>
</li>
</ul>
<p><img alt="" src="../P2_4/4.1-24.png" /></p>
<p>Podéis ver también el certificado:</p>
<p><img alt="" src="../P2_4/4.1-26.png" /></p>
<p>Y finalmente accedemos a nuestra web:</p>
<p><img alt="" src="../P2_4/4.1-27.png" /></p>
<p>Si ahora intentáis acceder a <strong><code>http://ejemplo-proxy</code></strong>, ¿deberíais poder acceder? Comprobadlo y describid qué pasa y por qué. </p>
<h3 id="redireccion-forzosa-a-https">Redirección forzosa a HTTPS</h3>
<p>Para que, indistintamente de la forma por la que accedamos al sitio web, siempre se fuerce a utilizar HTTPS, necesitaremos una configuración adicional. </p>
<p>Necesitamos añadir un bloque “server” adicional y separado del otro, al archivo de configuración de “ejemplo-proxy”. Algo así: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>server {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>        listen 80;
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>        server_name ejemplo-proxy;
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        access_log /var/log/nginx/http_access.log;
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        return 301 https://ejemplo-proxy$request_uri;
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>}
</code></pre></div>
<p>Con esta configuración le estamos diciendo que: </p>
<ul>
<li>
<p>Escuche en el puerto 80 (HTTP) </p>
</li>
<li>
<p>Que el nombre al que responderá el servidor/sitio web es <code>ejemplo-proxy</code> </p>
</li>
<li>
<p>Que guarde los logs de este bloque en ese directorio y con ese nombre </p>
</li>
<li>
<p>Cuando se recibe una petición con las dos condiciones anteriores, se devuelve un código HTTP 301: </p>
<ul>
<li>
<p><strong>HTTP 301 Moved Permanently</strong> (Movido permanentemente en español) es un código de estado de HTTP que indica que el host ha sido capaz de comunicarse con el servidor pero que el recurso solicitado ha sido movido a otra dirección permanentemente. Es muy importante configurar las redirecciones 301 en los sitios web y para ello hay diferentes métodos y sintaxis para realizar la redirección 301. </p>
</li>
<li>
<p>La <strong>redirección 301</strong> es un código o comando insertado por un Webmaster que permite redirigir a los usuarios y buscadores de un sitio web de un sitio a otro. </p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Aclaración</p>
<p>Es decir, lo que estamos haciendo es que cuando se reciba una petición HTTP (puerto 80) en <code>http://ejemplo-proxy</code>, se redirija a <code>https://ejemplo-proxy</code> (HTTPS).</p>
</div>
</li>
</ul>
<div class="admonition task">
<p class="admonition-title">Tarea</p>
<ul>
<li>
<p>Eliminad del otro bloque <code>server{…}</code> la líneas que hagan referencia a escuchar en el puerto 80 (listen 80…). </p>
</li>
<li>
<p>Reiniciad el servicio </p>
</li>
<li>
<p>Comprobad ahora que cuando entráis en <code>http://ejemplo-proxy</code>, automáticamente os redirige a la versión segura de la web. </p>
</li>
<li>
<p>Comprobad que cuando realizáis una petición en el archivo de log <code>http_access.log</code> aparece la redirección 301 y que, de la misma manera, aparece una petición GET en <code>https_access.log</code>. </p>
</li>
</ul>
</div>
<h2 id="evaluacion">Evaluación</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Criterio</th>
<th style="text-align: center;">Puntuación</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Configuración correcta y completa del servidor web</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuración correcta y completa del proxy inverso</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Creación correcta del certificado</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuración SSL correcta del proxy</td>
<td style="text-align: center;"><strong>2 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Comprobaciones</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Configuración correcta de la redirección forzosa a HTTPS y comprobaciones</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
<tr>
<td style="text-align: left;">Se ha prestado especial atención al formato del documento, haciendo un correcto uso del lenguaje técnico</td>
<td style="text-align: center;"><strong>1 puntos</strong></td>
</tr>
</tbody>
</table>
<!--
## Cuestiones finales

!!!Task "Cuestión 1"
    Hemos configurado nuestro servidor con todo lo que nos hace falta pero no nos funciona y da un error del tipo `This site can't provide a secure connection, ERR_SSL_PROTOCOL_ERROR.`

    Dentro de nuestro server block tenemos esto:

    <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">server</span><span class="w"> </span>{
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="nb">listen</span><span class="w"> </span><span class="m">443</span>;
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="nb">ssl_certificate</span><span class="w"> </span><span class="sx">/etc/nginx/ssl/enrico-berlinguer/server.crt</span>;
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="nb">ssl_certificate_key</span><span class="w"> </span><span class="sx">/etc/nginx/ssl/enrico-berlinguer/server.key</span>;
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="nb">ssl_protocols</span><span class="w"> </span>TLSv1.3;
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="nb">ssl_ciphers</span><span class="w"> </span>ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS;
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="nb">server_name</span><span class="w"> </span>enrico-berlinguer;
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="nb">access_log</span><span class="w"> </span><span class="sx">/var/log/nginx/https_access.log</span>;
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>...
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="err">}</span>
</code></pre></div>


!!!Task "Cuestión 2"
    Imaginad que intentamos acceder a nuestro sitio web HTTPS y nos encontramos con el siguiente error:

    ![](../P2_4/Your-connection-isnt-private-NET-ERR_CERT_REVOKED.png)

    Investigad qué está pasando y como se ha de solucionar.

-->









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>
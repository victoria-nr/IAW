
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://victoria-nr.github.io/IAW/P3.5-Flask/">
      
      
        <link rel="prev" href="../P3.4-Heroku/">
      
      
        <link rel="next" href="../P4.1-DNS/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>Práctica 3.5 - Despliegue de una aplicación Flask - Implantación de aplicaciones web</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-3NX5MD5C8H"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-3NX5MD5C8H",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-3NX5MD5C8H",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-35-despliegue-de-una-aplicacion-flask-python" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Implantación de aplicaciones web" class="md-header__button md-logo" aria-label="Implantación de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Implantación de aplicaciones web
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 3.5 - Despliegue de una aplicación Flask
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Implantación de aplicaciones web" class="md-nav__button md-logo" aria-label="Implantación de aplicaciones web" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Implantación de aplicaciones web
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          1. Talleres de introducción
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          1. Talleres de introducción
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tallerGitIntro/" class="md-nav__link">
        Taller 1: Introducción a git y GitHub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tallerGitRamasUniones/" class="md-nav__link">
        Taller 2: Git. Trabajando con ramas y uniones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tallerMarkdown/" class="md-nav__link">
        Taller 3: Introducción a Markdown
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          2. Arquitectura web. Implantación y administración de servidores web
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          2. Arquitectura web. Implantación y administración de servidores web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ArqWeb/" class="md-nav__link">
        Teoría - Arquitectura Web. Implantación y administración de servidores web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.1/" class="md-nav__link">
        Práctica 2.1 – Instalación y configuración del servidor web Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.2/" class="md-nav__link">
        Práctica 2.2 – Autenticación en Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.3/" class="md-nav__link">
        Práctica 2.3 – Proxy inverso con Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.4/" class="md-nav__link">
        Práctica 2.4 – Balanceo de carga con proxy inverso en Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.5/" class="md-nav__link">
        Practica 2.5 - Proxy inverso y balanceo de carga con SSL en NGINX
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          3. Implantación aplicaciones web PHP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          3. Implantación aplicaciones web PHP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.1.InstallServWebLAMP/" class="md-nav__link">
        Práctica 1:Instalación de un servidor LAMP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.2.PHPMyAdmin/" class="md-nav__link">
        Práctica 2: phpMyAdmin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.3.VirtualhostingApache/" class="md-nav__link">
        Práctica 3: VirtualHosting con Apache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../P1.4.AppBookMedik/" class="md-nav__link">
        Práctica 4: Instalación de la aplicación BookMedik
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="practica-35-despliegue-de-una-aplicacion-flask-python">Práctica 3.5: Despliegue de una aplicación Flask (Python)</h1>
<h2 id="prerrequisitos">Prerrequisitos</h2>
<p>Servidor Debian con los siguientes paquetes instalados:</p>
<ul>
<li>Nginx</li>
<li>Gunicorn</li>
<li>Pipenv</li>
</ul>
<h2 id="introduccion">Introducción</h2>
<h3 id="que-es-un-framework">¿Qué es un framework?</h3>
<p>Actualmente en el desarrollo moderno de aplicaciones web se utilizan distintos Frameworks que son herramientas que nos dan un esquema de trabajo y una serie de utilidades y funciones que nos facilita y nos abstrae de la construcción de páginas web dinámicas.</p>
<p>En general los Frameworks están asociado a lenguajes de programación (Ruby on Rails (Ruby), Symphony (PHP)), en el mundo de Python el más conocido es Django pero Flask es una opción que quizás no tenga una curva de aprendizaje tan elevada pero nos posibilita la creación de aplicaciones web igual de complejas de las que se pueden crear en Django.</p>
<h3 id="flask">Flask</h3>
<p>En la actualidad existen muchas opciones para crear páginas web y muchos lenguajes (PHP, JAVA), y en este caso Flask nos permite crear de una manera muy sencilla aplicaciones web con Python.</p>
<p>Flask es un “micro” Framework escrito en Python y concebido para facilitar el desarrollo de Aplicaciones Web bajo el patrón MVC.</p>
<p>La palabra “micro” no designa a que sea un proyecto pequeño o que nos permita hacer páginas web pequeñas sino que al instalar Flask tenemos las herramientas necesarias para crear una aplicación web funcional pero si se necesita en algún momento una nueva funcionalidad hay un conjunto muy grande extensiones (plugins) que se pueden instalar con Flask que le van dotando de funcionalidad.</p>
<p><img alt="" src="../img/flask.png" /></p>
<p>De principio en la instalación no se tienen todas las funcionalidades que se pueden necesitar pero de una manera muy sencilla se pueden extender el proyecto con nuevas funcionalidades por medio de plugins.</p>
<p>El patrón MVC es una manera o una forma de trabajar que permite diferenciar y separar lo que es el modelo de datos (los datos que van a tener la App que normalmente están guardados en BD), la vista (página HTML) y el controlador (donde se gestiona las peticiones de la app web).</p>
<h3 id="gunicorn">Gunicorn</h3>
<p>Cuando se implementa una aplicación web basada en Python, normalmente se tienen estas tres piezas:</p>
<ul>
<li>Servidor web (Nginx, Apache)</li>
<li>Servidor de aplicaciones WSGI (Gunicorn, uWSGI, mod_wsgi, Waitress)</li>
<li>Aplicación web (Django, Flask, Pyramid, FastAPI)</li>
</ul>
<p>Los servidores web procesan y distribuyen las solicitudes de los navegadores y otros clientes y envían respuestas a los mismos.</p>
<p>WSGI (Web Server Gateway Interface) proporciona un conjunto de reglas para estandarizar el comportamiento y la comunicación entre servidores web y aplicaciones web. Mediante el uso de servidores y aplicaciones web compatibles con WSGI, los desarrolladores pueden concentrar su tiempo y energía en el desarrollo de aplicaciones web en lugar de administrar la comunicación entre la aplicación y el servidor web.</p>
<p><img alt="" src="../img/gunicorn.png" style="height:300px;width:550px" /></p>
<p>Finalmente, Gunicorn, que es la abreviatura de Green Unicorn, es un servidor de aplicaciones WSGI que se encuentra entre el servidor web y su aplicación web, gestionando la comunicación entre los dos. Acepta solicitudes del servidor y las traduce (a través de WSGI) en algo que la aplicación web puede entender antes de pasarla a la aplicación web real. Envía respuestas desde la aplicación web al servidor. También se encarga de ejecutar varias instancias de la aplicación web, reiniciándolas según sea necesario y distribuyendo solicitudes a instancias saludables.</p>
<h3 id="gestor-de-paquetes-pip">Gestor de paquetes <code>pip</code></h3>
<p><code>pip</code> es el comando para instalar paquetes de Python integrados en las fuentes desde la versión 3.4.</p>
<p>Este comando automatiza la conexión al sitio https://pypi.org/, la descarga, la instalación e incluso la compilación del módulo solicitado.</p>
<p>Además, se ocupa de las dependencias de cada paquete.</p>
<h3 id="entornos-virtuales-en-python">Entornos virtuales en Python</h3>
<p>Un entorno virtual es una forma de tener múltiples instancias paralelas del intérprete de Python, cada una con diferentes conjuntos de paquetes y diferentes configuraciones. Cada entorno virtual contiene una copia independiente del intérprete de Python, incluyendo copias de sus utilidades de soporte.</p>
<p>Los paquetes instalados en cada entorno virtual sólo se ven en ese entorno virtual y en ningún otro. Incluso los paquetes grandes y complejos con binarios dependientes de la plataforma pueden ser acorralados entre sí en entornos virtuales.</p>
<p>De esta forma, tendremos entornos independientes entre sí, parecido a como ocurría con los directorios de los proyectos de <code>Node.js</code>. De este modo, los entornos virtuales de Python nos permiten instalar un paquete de Python en una ubicación aislada en lugar de instalarlo de manera global.</p>
<h3 id="pipenv">Pipenv</h3>
<p><code>Pipenv</code> es una herramienta que apunta a traer todo lo mejor del mundo de empaquetado (bundler, composer, npm, cargo, yarn, etc.) al mundo de Python. </p>
<p><img alt="" src="../img/pipenv.jpg" style="height:300px;width:550px" /></p>
<p>Automáticamente crea y maneja un entorno virtual para tus proyectos, también permite agregar/eliminar paquetes desde tu Pipfile así como como instalar/desinstalar paquetes. También genera lo más importante , el archivo <code>Pipfile.lock</code>, que es usado para producir determinado build.</p>
<p><img alt="" src="../img/pip.png" style="height:300px;width:550px" /></p>
<h2 id="procedimiento-completo-para-el-despliegue">Procedimiento completo para el despliegue</h2>
<ol>
<li>
<p>Instalamos el gestor de paquetes de Python pip:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>python3-pip
</code></pre></div>
</li>
<li>
<p>Instalamos el paquete <code>pipenv</code> para gestionar los entornos virtuales:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>pip3<span class="w"> </span>install<span class="w"> </span>pipenv
</code></pre></div>
</li>
<li>
<p>Y comprobamos que está instalado correctamente mostrando su versión:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/home/raul/.local/bin
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>pipenv<span class="w"> </span>--version
</code></pre></div>
</li>
<li>
<p>Creamos el directorio en el que almacenaremos nuestro proyecto:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>/var/www/nombre_mi_aplicacion
</code></pre></div>
</li>
<li>
<p>Al crearlo con <code>sudo</code>, los permisos pertenecen a root:</p>
<p><img alt="" src="../img/permisos_root.png" /></p>
</li>
<li>
<p>Hay que cambiarlo para que el dueño sea nuestro usuario (<code>raul-debian</code> en mi caso) y pertenezca al grupo <code>www-data</code>, el usuario usado por defecto por el servidor web para correr:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span><span class="nv">$USER</span>:www-data<span class="w"> </span>/var/www/mi_aplicacion
</code></pre></div>
</li>
<li>
<p>Establecemos los permisos adecuados a este directorio, para que pueda ser leído por todo el mundo:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">775</span><span class="w"> </span>/var/www/mi_aplicacion<span class="w">   </span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Es <strong>indispensable</strong> asignar estos permisos, de otra forma obtendríamos un error al acceder a la aplicación cuando pongamos en marcha <strong>Nginx</strong></p>
</div>
</li>
<li>
<p>Dentro del directorio de nuestra aplicación, creamos un archivo oculto <code>.env</code> que contendrá las variables de entorno necesarias:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>touch<span class="w"> </span>.env
</code></pre></div>
</li>
<li>
<p>Editamos el archivo y añadimos las variables, indicando cuál es el archivo <code>.py</code> de la aplicación y el entorno, que en nuestro caso será producción: </p>
<p><img alt="" src="../img/var_entorno.png" />    </p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En el mundo laboral real, se supone que la aplicación previamente ha pasado por los entornos de dev, test y preprod para el desarrollo y prueba de la misma, antes de pasarla a producción.</p>
</div>
</li>
<li>
<p>Iniciamos ahora nuestro entorno virtual. <code>Pipenv</code> cargará las variables de entorno desde el fichero <code>.env</code> de forma automática:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>pipenv<span class="w"> </span>shell
</code></pre></div>
Veremos que se nos inicia el entorno virtual, cosa que comprobamos porque aparece su nombre al inicio del prompt del shell:</p>
<p><img alt="" src="../img/entorno_virt.png" /></p>
</li>
<li>
<p>Usamos <code>pipenv</code> para instalar las dependencias necesarias para nuestro proyecto:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>pipenv<span class="w"> </span>install<span class="w"> </span>flask<span class="w"> </span>gunicorn
</code></pre></div>
</li>
<li>
<p>Vamos ahora a crear la aplicación <em>Flask</em> más simple posible, a modo de <em>PoC</em> (proof of concept o prueba de concepto). El archivo que contendrá la aplicación propiamente dicha será <code>application.py</code> y <code>wsgi.py</code> se encargará únicamente de iniciarla y dejarla corriendo:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>touch<span class="w"> </span>application.py<span class="w"> </span>wsgi.py
</code></pre></div>
Y tras crear los archivos, los editamos para dejarlos así:</p>
<p><img alt="" src="../img/app-wsgi.png" /></p>
</li>
<li>
<p>Corramos ahora nuestra aplicación a modo de comprobación con el servidor web integrado de Flask. Si especificamos la dirección <code>0.0.0.0</code> lo que le estamos diciendo al servidor es que escuche en todas sus interfaces, si las tuviera:</p>
<p><img alt="" src="../img/flask-server.png" /></p>
</li>
<li>
<p>Ahora podremos acceder a la aplicación desde nuestro ordenador, nuestra máquina anfitrión, introduciendo en un navegador web: <code>http://IP-maq-virtual:5000</code>:</p>
<p><img alt="" src="../img/app-1.png" /></p>
<p>Tras la comprobación, paramos el servidor con <code>CTRL+C</code></p>
</li>
<li>
<p>Comprobemos ahora que Gunicorn funciona correctamente también. Si os ha funcionado el servidor de desarrollo de Flask, podéis usar el siguiente comando para probar que la alicación funciona correctamente usando Gunicorn, accediendo con vuestro navegador de la misma forma que en el paso anterior:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>gunicorn<span class="w"> </span>--workers<span class="w"> </span><span class="m">4</span><span class="w"> </span>--bind<span class="w"> </span><span class="m">0</span>.0.0.0:5000<span class="w"> </span>wsgi:app
</code></pre></div>
Donde:</p>
<ul>
<li>
<p><code>--workers N</code> establece el número de <code>workers</code> o hilos que queremos utilizar, como ocurría con Node Express. Dependerá del número de cores que le hayamos dado a la CPU de nuestra máquina virtual.</p>
</li>
<li>
<p><code>--bind 0.0.0.0:5000</code> hace que el servidor escuche peticiones por todas sus interfaces de red y en el puerto 5000</p>
</li>
<li>
<p><code>wsgi:app</code> es el nombre del archivo con extensión <code>.py</code> y <code>app</code> es la instancia de la aplicación Flask dentro del archivo.</p>
</li>
</ul>
</li>
<li>
<p>Todavía dentro de nuestro entorno virtual, debemos tomar nota de cual es el path o ruta desde la que se ejecuta <code>gunicorn</code> para poder configurar más adelante un servicio del sistema. Podemos averigurarlo así:</p>
<p><img alt="" src="../img/path-gunicorn.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Y tras ello debemos salir de nuestro entorno virtual con el sencillo comando <code>deactivate</code></p>
</div>
</li>
<li>
<p>Puesto que ya debemos tener instalado Nginx en nuestro sistema, lo ininciamos y comprobamos que su estado sea activo:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>nginx
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nginx
</code></pre></div>
</li>
<li>
<p>Ya fuera de nuestro entorno virtual, crearemos un archivo para que <a href="https://es.wikipedia.org/wiki/Systemd">systemd</a> corra Gunicorn como un servicio del sistema más:</p>
<p><img alt="" src="../img/gunicorn-service.png" /></p>
<p>Donde:</p>
<ul>
<li><strong><code>User</code></strong>: Establece el usuario que tiene permisos sobre el directorio del proyecto (el que pusistéis en el paso 5)</li>
<li><strong><code>Group</code></strong>: Establece el grupo que tiene permisos sobre el directorio del proyecto (el que pusistéis en el paso 5)</li>
<li><strong><code>Environment</code></strong>: Establece el directorio <code>bin</code> (donde se guardan los binarios ejecutables) dentro del entorno virtual (lo vistéis en el paso 14)</li>
<li><strong><code>WorkingDirectory</code></strong>: Establece el directorio base donde reside nuestro proyecto </li>
<li><strong><code>ExecStart</code></strong>: Establece el <em>path</em> donde se encuentra el ejecutable de <code>gunicorn</code> dentro del entorno virtual, así como las opciones y comandos con los que se iniciará </li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Debéis cambiar los valores para que coincidan con los de vuestro caso particular.</p>
</div>
</li>
<li>
<p>Ahora, como cada vez que se crea un servicio nuevo de <code>systemd</code>, se habilita y se inicia:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nombre_mi_servicio
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>systemctl<span class="w"> </span>start<span class="w"> </span>nombre_mi_servicio
</code></pre></div>
<p>Recordad que el nombre del servicio es el nombre del archivo que creastéis en el paso anterior.</p>
<p>Pasemos ahora a configurar <u><strong>Nginx</strong></u>, que es algo que ya deberíamos tener dominado de capítulos anteriores.</p>
</li>
<li>
<p>Creamos un archivo con el nombre de nuestra aplicación y dentro estableceremos la configuración para ese sitio web. El archivo, como recordáis, debe estar en <code>/etc/nginx/sites-available/nombre_aplicacion</code> y tras ello lo editamos para que quede:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="l l-Scalar l-Scalar-Plain">server {</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">listen 80;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">server_name mi_aplicacion www.mi_aplicacion;</span><span class="w"> </span><span class="c1">#(1)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">access_log /var/log/nginx/mi_aplicacion.access.log;</span><span class="w"> </span><span class="c1">#(2)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">error_log /var/log/nginx/mi_aplicacion.error.log;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">location / {</span><span class="w"> </span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">include proxy_params;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">proxy_pass http://unix:/var/www/nombre_aplicacion/nombre_aplicacion.sock;</span><span class="w"> </span><span class="c1">#(3)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="err">}</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="err">}</span><span class="w">   </span>
</code></pre></div>
<ol>
<li>
<p>Nombre del dominio, ya veremos más adelante como el DNS resolverá este nombre para acceder a nuestra aplicación.</p>
</li>
<li>
<p>Dónde estarán ubicados los logs de acceso y de errores.</p>
</li>
<li>
<p>Bloque donde se le indica a Nginx que haga de proxy inverso hacia el socket creado en nuestra propia máquina por gunicorn para acceder a nuestra aplicación Flask.</p>
</li>
</ol>
</li>
<li>
<p>Recordemos que ahora debemos crear un link simbólico del archivo de sitios webs disponibles al de sitios web activos:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/nombre_aplicacion<span class="w"> </span>/etc/nginx/sites-enabled/
</code></pre></div>
<p>Y nos aseguramos de que se ha creado dicho link simbólico:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>ls<span class="w"> </span>-l<span class="w"> </span>/etc/nginx/sites-enabled/<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nombre_aplicacion
</code></pre></div>
</li>
<li>
<p>Nos aseguramos de que la configuración de Nginx no contiene errores, reiniciamos Nginx y comprobamos que se estado es activo:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>nginx<span class="w"> </span>-t
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nginx
</code></pre></div>
</li>
<li>
<p>Ya no podremos acceder por IP a nuestra aplicación ya que ahora está siendo servida por Gunicorn y Nginx, necesitamos acceder por su <code>server_name</code>. Puesto que aún no hemos tratado con el DNS, vamos a editar el archivo <code>/etc/hosts</code> de nuestra máquina anfitriona para que asocie la IP de la máquina virtual, a nuestro <code>server_name</code>.</p>
<p>Este archivo, en Linux, está en: <code>/etc/hosts</code></p>
<p>Y en Windows: <code>C:\Windows\System32\drivers\etc\hosts</code></p>
<p>Y deberemos añadirle la línea:</p>
<p><code>192.168.X.X myproject www.myproject</code></p>
<p>donde debéis sustituir la IP por la que tenga vuestra máquina virtual.</p>
</li>
<li>
<p>El último paso es comprobar que todo el desplieuge se ha realizado de forma correcta y está funcionando, para ello accedemos desde nuestra máquina anfitrión a:</p>
<p><code>http://nombre_aplicacion</code></p>
<p>O:</p>
<p><code>http://www.nombre_aplicacion</code></p>
<p>Y debería mostraros la misma página que en el paso 14:</p>
<p><img alt="" src="../img/app_final_funcinando.png" />      </p>
</li>
</ol>
<div class="admonition task">
<p class="admonition-title">Ejercicio</p>
<p>Repite todo el proceso con la aplicación del siguiente repositorio: <code>https://github.com/raul-profesor/Practica-3.5</code></p>
<p>Recuerda que deberás clonar el repositorio en tu directorio <code>/var/www</code>:</p>
<p><code>git clone https://github.com/raul-profesor/Practica-3.5</code></p>
<p>Y, <strong><em>tras activar el entorno virtual dentro del directorio del repositorio clonado</em></strong>, para instalar las dependencias del proyecto de la aplicación deberás hacer:</p>
<p><code>pipenv install -r requirements.txt</code></p>
<p>Y un último detalle, si miráis el código del proyecto, quee es muy sencillo, veréis que <em>Gunicorn</em> debe iniciarse ahora así:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>gunicorn --workers 4 --bind 0.0.0.0:5000 wsgi:app
</code></pre></div>
<p>Y el resto sería proceder tal y como hemos hecho en esta práctica.</p>
</div>
<div class="admonition warning atención">
<p class="admonition-title">Warning</p>
<p>Documenta adecuadamente con explicaciones y capturas de pantalla los procesos de despliegue de <strong>ambas</strong> aplicaciones en Flask, así como las respuestas a las cuestiones planteadas.</p>
</div>
<h2 id="cuestiones">Cuestiones</h2>
<div class="admonition task">
<p class="admonition-title">Cuestion 1</p>
<p>Busca, lee, entiende y explica qué es y para que sirve un servidor <em>WSGI</em></p>
</div>
<h2 id="tareas-de-ampliacion">Tareas de ampliación</h2>
<div class="admonition task">
<p class="admonition-title">Ampliación</p>
<p>Despliega cualquiera de las dos aplicaciones Flask presentadas aquí en Heroku.</p>
</div>
<h2 id="referencias">Referencias</h2>
<p><a href="https://openwebinars.net/blog/que-es-flask/">¿Qué es Flask?</a></p>
<p><a href="https://dev.to/brandonwallace/deploy-flask-the-easy-way-with-gunicorn-and-nginx-jgc">Deploy Flask The Easy Way With Gunicorn and Nginx!</a></p>
<p><a href="https://faun.pub/deploy-flask-app-with-nginx-using-gunicorn-7fda4f50066a">Deploy flask app with Nginx using Gunicorn</a></p>
<h2 id="evaluacion">Evaluación</h2>
<table>
<thead>
<tr>
<th>Criterio</th>
<th>Puntuación</th>
</tr>
</thead>
<tbody>
<tr>
<td>Despliegue correcto, completo y bien documentado del primer ejemplo</td>
<td><strong>2 puntos</strong></td>
</tr>
<tr>
<td>Despliegue correcto, completo y bien documentado del segundo ejemplo</td>
<td><strong>5 puntos</strong></td>
</tr>
<tr>
<td>Respuestas correctas a las cuestiones</td>
<td><strong>1 puntos</strong></td>
</tr>
<tr>
<td>Tarea de ampliación</td>
<td><strong>1 punto</strong></td>
</tr>
<tr>
<td>Se ha prestado especial atención al formato del documento, utilizando la plantilla actualizada y haciendo un correcto uso del lenguaje técnico</td>
<td><strong>2 puntos</strong></td>
</tr>
</tbody>
</table>


  




                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Volver al principio
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "toc.integrate", "search.highlight", "content.code.annotate"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>